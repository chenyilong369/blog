# 同源策略

**如果两个 URL 的协议、域名和端口都相同，我们就称这两个 URL 同源。**

浏览器默认两个相同的源之间是可以相互访问资源和操作 DOM 的。两个不同的源之间若想要相互访问资源或者操作 DOM，那么会有一套基础的安全策略的制约，我们把这称为同源策略。

同源策略主要体现在 DOM、Web 数据和网络这三个层面。

1. **DOM**

同源策略限制了来自不同源的 JavaScript 脚本对当前 DOM 对象读和写的操作。

同源的可以操作各自的 DOM，不同源的不能操作各自的 DOM。

2. **Web数据**

同源策略限制了不同源的站点读取当前站点的 Cookie、IndexDB、LocalStorage 等数据。

3. **网络**

同源策略限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点。

当然，同源策略提高了安全性，但牺牲了便利性。于是浏览器做了一下权衡：

- 页面中可以引用第三方资源，不过这也暴露了很多诸如 XSS 的安全问题，因此又在这种开放的基础之上引入了 CSP 来限制其自由程度。

> CSP 的核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联 JavaScript 代码。

- 使用 XMLHttpRequest 和 Fetch 都是无法直接进行跨域请求的，因此浏览器又在这种严格策略的基础之上引入了跨域资源共享策略(CORS)，让其可以安全地进行跨域操作。
- 两个不同源的 DOM 是不能相互操纵的，因此，浏览器中又实现了跨文档消息机制，让其可以比较安全地通信。

